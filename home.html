<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The (un)Stable Net — Home</title>
  <meta name="description" content="The (un)Stable Net — a blog about Business, Tech, AI & Content."/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{ --page:#ffffff; --ink:#0b152c; --muted:#4c5c83; --line:#e7edf7; --card:#ffffff; --primary:#1f4aff; --accent:#00b7ff; --chip:#eef4ff; --maxw:1120px; --shadow:0 10px 30px rgba(12,23,52,.08) }
    *{box-sizing:border-box}
    body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--ink); background:var(--page)}
    header{position:sticky; top:0; z-index:40; backdrop-filter:saturate(140%) blur(8px); background:rgba(255,255,255,.9); border-bottom:1px solid var(--line)}
    .wrap{max-width:var(--maxw); margin:0 auto; padding:0 20px}
    .nav{height:72px; display:flex; align-items:center; justify-content:space-between}
    .brand{display:flex; align-items:center; gap:12px}
    .mark{width:36px; height:36px; border-radius:12px; display:grid; place-items:center; color:#fff; background:conic-gradient(from 210deg, var(--primary), var(--accent)); box-shadow:var(--shadow)}
    nav ul{display:flex; list-style:none; gap:12px; margin:0; padding:0}
    .pill-btn{appearance:none; display:inline-flex; align-items:center; gap:6px; text-decoration:none; background:#fff; color:#1f3aa2; border:1.5px solid #dbe6ff; border-radius:14px; padding:12px 18px; font-weight:800; font-size:16px; line-height:1; transition:background .15s ease, box-shadow .15s ease; box-shadow:0 1px 0 rgba(12,23,52,.02)}
    .pill-btn:hover{ background:#f4f7ff }
    .pill-btn.primary{ background:linear-gradient(180deg,#2954ff,#1f4aff); color:#fff; border-color:#2140b8; box-shadow:0 6px 18px rgba(31,74,255,.20), inset 0 1px 0 rgba(255,255,255,.25) }
    .pill-row{display:flex; align-items:center; gap:12px}

    /* Hero */
    .hero{border-bottom:1px solid var(--line)}
    .hero.financial{ position:relative; background-image:linear-gradient(180deg, rgba(31,74,255,0.12), rgba(0,183,255,0.08)), var(--hero, linear-gradient(180deg,#f7faff 0%,#ffffff 60%)); background-size:cover; background-position:center }
    .hero.financial::before{ content:""; position:absolute; inset:0; background-image:linear-gradient(to right, rgba(12,23,52,0.06) 1px, transparent 1px), linear-gradient(to bottom, rgba(12,23,52,0.06) 1px, transparent 1px); background-size:48px 48px; pointer-events:none }
    .hero.financial::after{ content:""; position:absolute; top:-30%; right:-20%; width:60%; height:160%; background:radial-gradient(closest-side, rgba(31,74,255,0.18), transparent 70%); pointer-events:none }
    .hero .inner{position:relative; max-width:var(--maxw); margin:0 auto; padding:40px 20px}
    .cover-title{font-size: clamp(30px, 3.8vw, 48px); line-height:1.08; margin:6px 0; color:#0b152c}
    .muted{ color: var(--muted); }

    /* Chips, cards, grid */
    .chip{background:var(--chip); border:1px solid #dbe6ff; color:#2140b8; padding:6px 10px; border-radius:999px; font-weight:800; font-size:12px}
    .cards{ display:grid; grid-template-columns: repeat(auto-fill, minmax(280px,1fr)); gap:14px }
    .card{ display:flex; flex-direction:column; background:#fff; border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow); overflow:hidden; transition:transform .12s ease, box-shadow .12s ease; text-decoration:none; color:inherit; }
    .card:hover{ transform:translateY(-1px); box-shadow:0 12px 36px rgba(12,23,52,.10) }
    .card .thumb{ aspect-ratio:16/9; background:#0b1b3a; object-fit:cover; width:100% }
    .card .body{ padding:12px }
    .card h4{ margin:0 0 4px 0; font-size:16px; line-height:1.25; font-weight:800; color:#0b152c }
    .card .deck{ margin:0 0 8px 0; color:#4c5c83; font-size:13px }
    .card.disabled{ pointer-events:none; opacity:.65 }

    /* Prose bits */
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
    footer{border-top:1px solid var(--line); padding:18px 0; color:#6b7897}

    @media (max-width: 640px){
      .hero .inner{ padding:28px 16px }
      .cover-title{ font-size: clamp(24px, 7vw, 36px) }
      .cards{ grid-template-columns:1fr; gap:12px }
    }
  </style>

  <!-- Viewer lock (no changes to your policy files) -->
  <link rel="stylesheet" href="assets/access-mode.css">
  <script defer src="assets/access-mode.js"></script>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand">
        <div class="mark" aria-hidden="true">TSN</div>
        <h1 class="text-lg font-extrabold">The (un)Stable Net</h1>
      </div>
      <nav aria-label="Primary">
        <ul class="pill-row">
          <li><a class="pill-btn" href="home.html">Home</a></li>
          <li><a class="pill-btn" href="#projects">Projects</a></li>
          <li><a class="pill-btn" href="emm.html#latest">Newsletter</a></li>
          <li><a class="pill-btn" href="bio.html">About me</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero financial" aria-label="Cover">
    <div class="inner">
      <h2 class="cover-title">The (un)Stable Net</h2>
      <p class="muted">A blog about Business, Tech, AI & Content.</p>

      <!-- Newsletter callout + preview -->
      <div class="mt-4" style="display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:var(--shadow); padding:10px;">
        <div>
          <div class="chip" aria-hidden="true">Newsletter</div>
          <div class="font-semibold mt-1">European Market Movers</div>
          <div id="emm-subtitle" class="text-sm muted">A weekly, PM-style wrap of European markets: what moved, why it mattered, and what’s next.</div>
        </div>
        <div style="display:flex; gap:8px; align-items:center">
          <input type="email" placeholder="info@example.com" aria-label="Email" style="border:1px solid #cad7f5; border-radius:10px; padding:10px 12px; font:inherit;">
          <a id="emm-cta" class="pill-btn primary" href="emm.html#latest">Read latest</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Projects -->
  <main class="wrap">
    <section id="projects" aria-label="Projects" class="mt-6">
      <h3 class="text-lg font-extrabold mb-2">Projects</h3>
      <div class="cards">

        <!-- MSAB -->
        <a class="card" href="msab.html">
          <img class="thumb" alt="" src="" aria-hidden="true">
          <div class="body">
            <div class="chip">Platform</div>
            <h4>Million Slots Billboard</h4>
            <p class="deck">A permanent AI video mosaic with 1,000,000 micro-slots. Claim space and publish.</p>
          </div>
        </a>

        <!-- EMM (auto-updates to latest if available) -->
        <a id="emmCardLink" class="card" href="emm.html#latest">
          <img id="emmCardThumb" class="thumb" alt="" src="" aria-hidden="true">
          <div class="body">
            <div class="chip">Newsletter</div>
            <h4 id="emmCardTitle">European Market Movers</h4>
            <p id="emmCardDeck" class="deck">Weekly, PM-style wrap of European markets.</p>
          </div>
        </a>

        <!-- Coming soon (not clickable) -->
        <article class="card disabled" aria-disabled="true">
          <img class="thumb" alt="" src="" aria-hidden="true">
          <div class="body">
            <div class="chip">Coming up</div>
            <h4>New projects coming soon…</h4>
            <p class="deck">Stay tuned</p>
          </div>
        </article>

      </div>
    </section>
  </main>

  <footer>
    <div class="wrap mini" style="margin-top:6px; display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:wrap; text-align:center;">
      <span>© 2025 The (un)Stable Net</span>
      <span aria-hidden="true">•</span>
      <a href="assets/legal/privacy-policy.pdf" target="_blank" rel="noopener noreferrer" class="hover:underline underline-offset-4">Privacy Policy (PDF)</a>
      <span aria-hidden="true" class="hidden sm:inline">•</span>
      <a href="assets/legal/terms.pdf" target="_blank" rel="noopener noreferrer" class="hover:underline underline-offset-4">Terms &amp; Conditions (PDF)</a>
    </div>
  </footer>

  <!-- Optional Supabase init (keeps working even if not present) -->
  <script type="module" src="assets/sb-init.js"></script>

  <!-- Dynamic: preview latest EMM (SB if available, else localStorage) -->
  <script>
    const hasSB = () => !!(window.supabase || (window.sb && window.sb.supabase));
    const sb = () => window.supabase || (window.sb && window.sb.supabase) || null;

    function stripToText(html){ const d=document.createElement('div'); d.innerHTML=html||''; return (d.textContent||'').trim(); }
    function normalizePost(p){
      if(!p) return null;
      return {
        id: p.id,
        title: p.title,
        subtitle: p.subtitle,
        excerpt: p.excerpt,
        cover: p.cover || p.cover_url,
        bodyHtml: p.bodyHtml || p.body_html,
        dateISO: p.dateISO || p.date_iso
      };
    }

    async function getLatestEMM(){
      // 1) Try Supabase
      if(hasSB()){
        try{
          const { data, error } = await sb().from('emm_posts').select('*').order('dateISO', { ascending:false }).limit(1).maybeSingle();
          if(!error && data) return normalizePost(data);
        }catch(e){}
      }
      // 2) Fallback to localStorage (set by emm.html after you publish there)
      try{
        const arr = JSON.parse(localStorage.getItem('emm_posts')||'[]');
        if(Array.isArray(arr) && arr.length){
          arr.sort((a,b)=> (b.dateISO||'').localeCompare(a.dateISO||''));
          return normalizePost(arr[0]);
        }
      }catch(e){}
      return null;
    }

    (async function hydrateEMM(){
      const latest = await getLatestEMM();
      if(!latest) return;

      // Hero callout
      const sub = document.getElementById('emm-subtitle');
      const cta = document.getElementById('emm-cta');
      if(sub) sub.textContent = latest.subtitle || latest.excerpt || stripToText(latest.bodyHtml).slice(0,160);
      if(cta) cta.href = `emm.html#post/${latest.id}`;

      // Projects card
      const link = document.getElementById('emmCardLink');
      const title = document.getElementById('emmCardTitle');
      const deck = document.getElementById('emmCardDeck');
      const thumb = document.getElementById('emmCardThumb');
      if(title) title.textContent = latest.title || 'European Market Movers';
      if(deck) deck.textContent = latest.excerpt || latest.subtitle || stripToText(latest.bodyHtml).slice(0,180);
      if(link) link.href = `emm.html#post/${latest.id}`;
      if(thumb && latest.cover){
        thumb.src = latest.cover;
        thumb.alt = '';
      }
    })();
  </script>

  <!-- Keep your viewer policy scripts if needed on Home too -->
  <script type="module" src="assets/editor-auth.js"></script>
  <script type="module" src="assets/editor-tray.js"></script>
  <script type="module" src="assets/editor-quiet.js"></script>
  <script type="module" src="assets/editor-unlock.js"></script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <link rel="stylesheet" href="assets/access-mode.css">
<script defer src="assets/access-mode.js"></script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>European Market Movers — Weekly</title>
  <meta name="description" content="European Market Movers — a PM-style weekly wrap of European markets: what moved, why it mattered, what’s next."/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --page:#ffffff; --ink:#0b152c; --muted:#4c5c83; --line:#e7edf7; --card:#ffffff; --primary:#1f4aff; --accent:#00b7ff; --chip:#eef4ff; --maxw:1120px; --shadow:0 10px 30px rgba(12,23,52,.08) }
    *{box-sizing:border-box}
    body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--ink); background:var(--page)}
    header{position:sticky; top:0; z-index:40; backdrop-filter:saturate(140%) blur(8px); background:rgba(255,255,255,.9); border-bottom:1px solid var(--line)}
    .wrap{max-width:var(--maxw); margin:0 auto; padding:0 20px}
    .nav{height:72px; display:flex; align-items:center; justify-content:space-between}
    .brand{display:flex; align-items:center; gap:12px}
    .mark{width:36px; height:36px; border-radius:12px; display:grid; place-items:center; color:#fff; background:conic-gradient(from 210deg, var(--primary), var(--accent)); box-shadow:var(--shadow)}
    nav ul{display:flex; list-style:none; gap:12px; margin:0; padding:0}
    .pill-btn{
      appearance:none; display:inline-flex; align-items:center; gap:6px;
      text-decoration:none; background:#fff; color:#1f3aa2;
      border:1.5px solid #dbe6ff; border-radius:14px;
      padding:12px 18px; font-weight:800; font-size:16px; line-height:1;
      transition:background .15s ease, box-shadow .15s ease;
      box-shadow:0 1px 0 rgba(12,23,52,.02);
    }
    .pill-btn:hover{ background:#f4f7ff; }
    .pill-btn.primary{
      background:linear-gradient(180deg,#2954ff,#1f4aff); color:#fff; border-color:#2140b8;
      box-shadow:0 6px 18px rgba(31,74,255,.20), inset 0 1px 0 rgba(255,255,255,.25);
    }
    .pill-row{display:flex; align-items:center; gap:12px}

    /* Hero */
    .hero{border-bottom:1px solid var(--line)}
    .hero.financial{position:relative; background-image:linear-gradient(180deg, rgba(31,74,255,0.12), rgba(0,183,255,0.08)), var(--hero, linear-gradient(180deg,#f7faff 0%,#ffffff 60%)); background-size:cover; background-position:center}
    .hero.financial::before{content:""; position:absolute; inset:0; background-image:linear-gradient(to right, rgba(12,23,52,0.06) 1px, transparent 1px), linear-gradient(to bottom, rgba(12,23,52,0.06) 1px, transparent 1px); background-size:48px 48px; pointer-events:none}
    .hero.financial::after{content:""; position:absolute; top:-30%; right:-20%; width:60%; height:160%; background:radial-gradient(closest-side, rgba(31,74,255,0.18), transparent 70%); pointer-events:none}
    .hero .inner{position:relative; max-width:var(--maxw); margin:0 auto; padding:40px 20px}
    .cover-title{font-size: clamp(30px, 3.8vw, 48px); line-height:1.08; margin:6px 0; color:#0b152c}

    /* Editor/uploader + article + comments (unchanged) */
    .editor{background:#fff; border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow); padding:14px; margin:18px 0}
    .field{display:flex; flex-direction:column; gap:6px; margin-bottom:10px}
    .field label{font-size:12px; font-weight:700; color:#3a4a74}
    .field input,.field textarea,.field select{font:inherit; padding:10px 12px; border:1px solid #cad7f5; border-radius:10px}
    .two{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .tabs{display:flex; gap:8px; margin:6px 0}
    .tabs button{padding:6px 10px; border:1px solid #cad7f5; background:#fff; border-radius:999px; font-weight:700; cursor:pointer}
    .tabs button.active{background:#e9f1ff}
    .article{margin:0 0 40px}
    .post-head h1{font-size: clamp(28px, 4vw, 46px); line-height:1.08; margin:6px 0}
    .post-head .subtitle{color:var(--muted); margin:0 0 8px 0}
    .meta{display:flex; align-items:center; gap:8px; flex-wrap:wrap; color:#5d6a8e; font-size:13px}
    .chip{background:var(--chip); border:1px solid #dbe6ff; color:#2140b8; padding:6px 10px; border-radius:999px; font-weight:800; font-size:12px}
    .prose p{margin:1em 0; line-height:1.68}
    .prose h2{margin-top:1.4em; font-size:1.25rem}
    .prose img{max-width:100%; border-radius:12px; display:block; margin:12px 0}
    .prose figure{margin:14px 0}
    .prose figcaption{font-size:12px; color:#5d6a8e; text-align:center}
    .prose blockquote{border-left:4px solid var(--line); padding:6px 12px; color:#3a4a74; background:#f7faff; border-radius:8px}
    .comments{border-top:1px solid var(--line); padding-top:18px; margin-top:24px}
    .comment-item{padding:12px 0; border-bottom:1px solid var(--line)}
    .comment-item:last-child{border-bottom:0}
    .comment-author{font-weight:700}
    .comment-meta{font-size:12px; color:#6b7897}
    .comment-text{margin:8px 0 0 0; white-space:pre-wrap}

    /* Contribute dialog (unchanged styles) */
    dialog.contrib{border:none; border-radius:16px; width:min(680px, 92vw); padding:0; box-shadow:0 24px 80px rgba(12,23,52,.25)}
    .dlg-head{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--line)}
    .dlg-body{padding:14px 16px}
    .dlg-actions{display:flex; gap:10px; padding:12px 16px; border-top:1px solid var(--line); justify-content:flex-end}
    .close-x{appearance:none; border:1px solid #dbe6ff; background:#fff; border-radius:10px; padding:6px 10px; cursor:pointer; font-weight:700}

    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
    .hide{display:none}
    body.empty #article{display:none}
    footer{border-top:1px solid var(--line); padding:18px 0; color:#6b7897}
    @media (max-width: 780px){ .two{grid-template-columns:1fr} }
  </style>

  <!-- viewer lock (keeps the look; no visual change) -->
  <link rel="stylesheet" href="assets/access-mode.css">
  <script defer src="assets/access-mode.js"></script>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand"><div class="mark" aria-hidden="true">TSN</div><h1 class="text-lg font-extrabold">The (un)Stable Net</h1></div>
      <nav aria-label="Primary">
        <ul class="pill-row">
          <li><a class="pill-btn" href="index.html">Home</a></li>
          <!-- make Contribute usable for viewers -->
          <li><button id="openContrib" class="pill-btn primary" type="button" data-view-allowed>
  Contribute
</button>
</li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Hero stays exactly like the old page -->
  <section class="hero financial" aria-label="Section cover">
    <div class="inner">
      <h2 class="cover-title">European Market Movers</h2>
      <p class="text-slate-600 max-w-2xl"><i>A weekly wrap of European markets: what moved, why it mattered and what’s next.</i></p>
    </div>
  </section>

  <main class="wrap">
    <!-- Uploader -->
    <section id="upload" class="editor" aria-labelledby="uploader-title">
      <div class="flex items-center justify-between mb-2">
        <strong id="uploader-title">Upload article</strong>
        <span class="text-xs text-slate-500" id="draftStatus">Draft</span>
      </div>

      <div class="field"><label for="aTitle">Title</label><input id="aTitle" placeholder="Week NN — headline"/></div>
      <div class="field"><label for="aSubtitle">Subtitle / Deck</label><textarea id="aSubtitle" rows="2" placeholder="Short deck as in the example"></textarea></div>
      <div class="two">
        <div class="field"><label for="aAuthor">Author</label><input id="aAuthor" placeholder="Your name" value="Jacopo Berton"/></div>
        <div class="field"><label for="aDate">Date</label><input id="aDate" type="date"/></div>
      </div>

      <div class="two">
        <div class="field"><label for="aTags">Tags (comma-separated)</label><input id="aTags" placeholder="Equities, Rates, FX"/></div>
        <div class="field"><label for="aExcerpt">Excerpt (optional)</label><input id="aExcerpt" placeholder="Short summary used in previews"/></div>
      </div>

      <div class="two">
        <div class="field"><label for="aCoverUrl">Cover image URL</label><input id="aCoverUrl" placeholder="https://... (optional)"/></div>
        <div class="field"><label for="aCoverFile">Or upload cover file</label><input id="aCoverFile" type="file" accept="image/*"/></div>
      </div>

      <div class="tabs" role="tablist">
        <button id="tabText" class="active" type="button">Text</button>
        <button id="tabHtml" type="button">HTML</button>
      </div>
      <div id="paneText" role="tabpanel">
        <div class="field"><label for="aText">Text content</label><textarea id="aText" rows="10" placeholder="Write your article as plain text. Use blank lines between paragraphs."></textarea></div>
      </div>
      <div id="paneHtml" role="tabpanel" hidden>
        <div class="field"><label for="aHtml">HTML content</label><textarea id="aHtml" rows="12" placeholder="Paste full HTML or snippets (e.g. &lt;h2&gt;, &lt;p&gt;, &lt;ul&gt;, callouts)"></textarea></div>
      </div>

      <div class="two">
        <button id="publishBtn" class="pill-btn primary" type="button">Publish</button>
        <button id="clearBtn" class="pill-btn" type="button">Clear form</button>
      </div>
    </section>

    <!-- Article -->
    <section id="article" class="article" aria-labelledby="postTitle" hidden>
      <article class="post">
        <header class="post-head">
          <h1 id="postTitle"></h1>
          <p id="postSubtitle" class="subtitle"></p>
          <div class="meta">
            <span id="postAuthor"></span>
            <span>•</span>
            <time id="postDate" datetime=""></time>
            <span>•</span>
            <span id="postReadTime"></span>
            <div id="postTags" class="flex gap-2" style="margin-left:8px"></div>
          </div>
        </header>
        <div id="postBody" class="prose"></div>
      </article>

      <!-- Comments -->
      <section id="comments" class="comments" aria-labelledby="commentsTitle" hidden>
        <div class="flex items-center justify-between">
          <h3 id="commentsTitle" class="text-lg font-extrabold">Comments</h3>
          <span id="commentsCount" class="text-xs text-slate-500">0</span>
        </div>
        <div id="commentsList" class="mt-2"></div>
        <form id="commentForm" class="editor mt-3" aria-label="Add a comment">
          <div class="two">
            <div class="field"><label for="cName">Name</label><input id="cName" autocomplete="name" placeholder="Your name"/></div>
            <div class="field"><label for="cEmail">Email (not shown)</label><input id="cEmail" type="email" autocomplete="email" placeholder="you@example.com"/></div>
          </div>
          <div class="field"><label for="cText">Comment</label><textarea id="cText" rows="4" placeholder="Be respectful. No HTML allowed."></textarea></div>
          <div class="flex items-center justify-between">
            <span class="text-xs text-slate-500">Stored locally in your browser for this article.</span>
            <button class="pill-btn primary" type="submit">Post comment</button>
          </div>
        </form>
      </section>
    </section>
  </main>

  <footer>
    <div class="wrap mini" style="margin-top:6px; display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:wrap; text-align:center;">
      <span>© 2025 The (un)Stable Net</span>
      <span aria-hidden="true">•</span>
      <a href="assets/legal/privacy-policy.pdf" target="_blank" rel="noopener noreferrer" class="hover:underline underline-offset-4">Privacy Policy (PDF)</a>
      <span aria-hidden="true" class="hidden sm:inline">•</span>
      <a href="assets/legal/terms.pdf" target="_blank" rel="noopener noreferrer" class="hover:underline underline-offset-4">Terms &amp; Conditions (PDF)</a>
    </div>
  </footer>

  <!-- Contribute dialog (original layout; just whitelisted for Viewer) -->
  <dialog id="contribDialog" class="contrib" data-view-allowed>
    <form method="dialog" id="contribFormContainer" data-view-allowed>
      <div class="dlg-head">
        <strong>Contribute to EMM</strong>
        <button class="close-x" id="closeContrib" value="cancel" aria-label="Close" data-view-allowed>Close</button>
      </div>
      <div class="dlg-body">
        <div class="two">
          <div class="field"><label for="ctName">Name</label><input id="ctName" required placeholder="Your name" data-view-allowed/></div>
          <div class="field"><label for="ctEmail">Email</label><input id="ctEmail" type="email" required placeholder="you@example.com" data-view-allowed/></div>
        </div>
        <div class="two">
          <div class="field">
            <label for="ctType">Contribution type</label>
            <select id="ctType" data-view-allowed>
              <option value="tip">Market tip / lead</option>
              <option value="chart">Chart / data point</option>
              <option value="correction">Correction / feedback</option>
              <option value="guest">Guest paragraph / op-ed</option>
            </select>
          </div>
          <div class="field">
            <label for="ctFile">Attachment (optional)</label>
            <input id="ctFile" type="file" data-view-allowed />
          </div>
        </div>
        <div class="field"><label for="ctMsg">Message</label><textarea id="ctMsg" rows="5" required placeholder="What would you like to share?" data-view-allowed></textarea></div>
        <label class="text-xs text-slate-600 flex items-center gap-2">
          <input id="ctConsent" type="checkbox" required data-view-allowed />
          I consent to being contacted about this submission.
        </label>
      </div>
      <div class="dlg-actions">
        <button class="pill-btn" value="cancel" type="button" id="cancelContrib" data-view-allowed>Cancel</button>
        <button class="pill-btn primary" id="submitContrib" type="button" data-view-allowed>Send</button>
      </div>
    </form>
  </dialog>

  <!-- State & Scripts (unchanged behavior) -->
  <script id="emm-state" type="application/json">{"posts":[]}</script>
  <script>
    /* (the big inline script you already had — unchanged) */
    /* It renders the article and handles Contribute locally. */
    /* ... all your inline JS exactly as in the OLD file ... */
  </script>

  <!-- Keep Supabase client + editor tray, but remove dynamic-emm to preserve the old look -->
  <script type="module" src="assets/sb-init.js"></script>
<script type="module" src="assets/dynamic-emm.js"></script>  <!-- add/keep THIS -->
<script type="module" src="assets/editor-auth.js"></script>
<script type="module" src="assets/editor-tray.js"></script>
<script type="module" src="assets/editor-quiet.js"></script>
<script type="module" src="assets/editor-unlock.js"></script>
 <script>
  // Minimal wiring so Contribute opens/closes, independent of the old "el" object
  document.addEventListener('DOMContentLoaded', function () {
    const btn = document.getElementById('openContrib');
    const dlg = document.getElementById('contribDialog');
    const closeBtn = document.getElementById('closeContrib');
    const cancelBtn = document.getElementById('cancelContrib');

    function open() {
      if (!dlg) return;
      if (typeof dlg.showModal === 'function') dlg.showModal();
      else dlg.style.display = 'block';
    }
    function close(e) {
      if (e) e.preventDefault();
      if (!dlg) return;
      if (dlg.open && typeof dlg.close === 'function') dlg.close();
      else dlg.style.display = 'none';
    }

    if (btn && dlg) btn.addEventListener('click', open, { capture: true }); // capture so viewer-lock never blocks it
    if (closeBtn) closeBtn.addEventListener('click', close, { capture: true });
    if (cancelBtn) cancelBtn.addEventListener('click', close, { capture: true });

    // close when clicking the backdrop
    if (dlg) {
      dlg.addEventListener('click', (e) => {
        const r = dlg.getBoundingClientRect();
        if (e.clientX < r.left || e.clientX > r.right || e.clientY < r.top || e.clientY > r.bottom) close();
      }, { capture: true });
    }
  });
</script>
  <script type="module" src="assets/sb-init.js"></script>
<script type="module" src="assets/editor-auth.js"></script>
<script type="module" src="assets/editor-tray.js"></script>

</body>
</html>
